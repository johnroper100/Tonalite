<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">


    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&dispsay=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/vue-multiselect@2.1.0/dist/vue-multiselect.min.css">
    <link href="static/all.min.css" rel="stylesheet" />
    <link href="static/style.css" rel="stylesheet" />

    <title>Tonalite</title>
</head>

<body>
    <div id="app" v-bind:class="{inLayout: fixtureGridLayout}">
        <div class="sticky-top">
            <div class="header p-2 ps-3 pe-3">
                <span class="brand">Tonalite</span>
                <div class="float-end">
                    <div class="dropdown d-inline-block me-2">
                        <span class="menu-dropdown dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            File
                        </span>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                            <li><a class="dropdown-item" @click="saveShow">Save</a></li>
                        </ul>
                    </div>
                    <div class="dropdown d-inline-block">
                        <span class="menu-dropdown dropdown-toggle" id="dropdownMenuButton" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            Settings
                        </span>
                        <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButton">
                        </ul>
                    </div>
                </div>
            </div>
            <div class="sub-header p-2" v-if="tab == 'fixtures'">
                <select class="form-select d-inline-block" v-model="fixturesTab">
                    <option value="fixturesList">Fixture List</option>
                    <option value="fixturesGrid" class="d-none d-md-inline-block">Fixture Grid</option>
                    <option value="groups">Group List</option>
                    <option value="patch">Patch</option>
                </select>
                <div class="float-end d-inline-block">
                    <button class="btn btn-success" v-if="fixturesTab == 'patch'" @click="getFixtureProfiles">
                        <i class="fa-regular fa-circle-plus d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Add Fixture</span>
                    </button>
                    <button class="btn btn-warning" v-if="fixturesTab == 'patch'" @click="rdmSearch">
                        <i class="fa-regular fa-wifi d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">RDM Search</span>
                    </button>
                    <button class="btn btn-success" @click="fixtureParameters"
                        v-if="fixturesTab == 'fixturesList' || fixturesTab == 'fixturesGrid'"
                        v-bind:class="{ disabled: selectedFixtures.length == 0 }">
                        <i class="fa-regular fa-sliders d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Parameters</span>
                    </button>
                    <button class="btn btn-danger" v-if="fixturesTab == 'patch'" @click="removeFixtures"
                        v-bind:class="{ disabled: selectedFixtures.length == 0 }">
                        <i class="fa-regular fa-trash-can d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Delete</span>
                    </button>
                    <button class="btn btn-danger" v-if="fixturesTab == 'fixturesList' || fixturesTab == 'fixturesGrid'"
                        v-bind:class="{ disabled: selectedFixtures.length < 2 }" @click="groupFixtures">
                        <i class="fa-regular fa-object-group d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Group</span>
                    </button>
                    <button class="btn btn-primary"
                        v-if="fixturesTab == 'fixturesList' || fixturesTab == 'fixturesGrid' || fixturesTab == 'patch'"
                        v-bind:class="{ disabled: selectedFixtures.length == 0 }" @click="selectedFixtures = []">
                        <span class="fa-stack small">
                            <i class="fa-solid fa-hand-pointer fa-stack-1x"></i>
                            <i class="fa-solid fa-ban fa-stack-2x"></i>
                        </span>
                        <span class="d-none d-sm-inline-block">Deselect</span>
                    </button>
                    <button class="btn d-none d-md-inline-block" v-if="fixturesTab == 'fixturesGrid'"
                        v-bind:class="{'btn-success': fixtureGridLayout }"
                        @click="fixtureGridLayout = !fixtureGridLayout">
                        <i class="fa-regular fa-up-down-left-right d-inline-block"></i>
                        <span class="d-none d-sm-inline-block">Move Items</span>
                    </button>

                    <!-- Groups Buttons -->
                    <button class="btn btn-success" v-if="fixturesTab == 'groups'"
                        v-bind:class="{ disabled: selectedGroups.length == 0 }">
                        <i class="fa-regular fa-sliders d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Parameters</span>
                    </button>
                    <button class="btn btn-warning" v-if="fixturesTab == 'groups'"
                        v-bind:class="{ disabled: selectedGroups.length == 0 }" @click="viewGroupSettings">
                        <i class="fa-regular fa-gear d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Settings</span>
                    </button>
                    <button class="btn btn-danger" v-if="fixturesTab == 'groups'"
                        v-bind:class="{ disabled: selectedGroups.length == 0 }" @click="removeGroups">
                        <i class="fa-regular fa-trash-can d-inline-block fa-lg"></i>
                        <span class="d-none d-sm-inline-block">Delete</span>
                    </button>
                    <button class="btn btn-primary" v-if="fixturesTab == 'groups'"
                        v-bind:class="{ disabled: selectedGroups.length == 0 }" @click="selectedGroups = []">
                        <span class="fa-stack small">
                            <i class="fa-solid fa-hand-pointer fa-stack-1x"></i>
                            <i class="fa-solid fa-ban fa-stack-2x"></i>
                        </span>
                        <span class="d-none d-sm-inline-block">Deselect</span>
                    </button>
                </div>
            </div>
        </div>
        <div class="container-fluid mb-5" v-if="tab == 'fixtures'">
            <grid-layout :layout.sync="fixtures" :col-num="24" :row-height="25" :vertical-compact="false"
                :is-resizable="fixtureGridLayout" :prevent-collision="true" :is-draggable="fixtureGridLayout"
                v-if="fixturesTab == 'fixturesGrid'">
                <div class="col-12 mt-3" v-if="fixtures.length == 0">
                    No fixtures have been patched. Use either the Add Fixture or RDM Search tools in the Patch tab to
                    add some to this show.
                </div>
                <grid-item v-for="item in fixtures" class="fixtureItem text-center"
                    v-bind:class="{ selected: selectedFixtures.indexOf(item.i) >= 0 }" :min-w="2" :min-h="1" :x="item.x"
                    :y="item.y" :w="item.w" :h="item.h" :i="item.i" :key="item.i" @moved="moveFixture"
                    @resized="resizeFixture">
                    <div @click="selectFixture(item.i)" class="h-100">
                        <i class="fa-regular fa-lightbulb d-none d-lg-inline-block"></i>
                        {{item.universe}}:{{item.address}}
                    </div>
                </grid-item>
            </grid-layout>
            <div class="row mt-3" v-if="fixturesTab == 'fixturesList'">
                <div class="col-12" v-if="fixtures.length == 0">
                    No fixtures have been patched. Use either the Add Fixture or RDM Search tools in the Patch tab to
                    add some to this show.
                </div>
                <div class="col-6 col-md-3 col-lg-2 col-xl-1 text-center mb-3" v-for="item in fixtures">
                    <div class="fixtureItem p-2" @click="selectFixture(item.i)"
                        v-bind:class="{ selected: selectedFixtures.indexOf(item.i) >= 0 }">
                        <h5 class="mb-0 pb-2">100%</h5>
                        {{item.name}} ({{item.universe}}:{{item.address}})
                    </div>
                </div>
            </div>
            <div class="mt-3" v-if="fixturesTab == 'patch'">
                <div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" id="fixtureModal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Add Fixture</h5>
                                <button type="button" class="btn btn-secondary" data-dismiss="modal" aria-label="Close">
                                    <i class="fa-regular fa-xmark"></i>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="row mb-3">
                                    <div class="col-4">
                                        Universe:
                                        <input type="number" class="form-control" v-model="fixtureProfileUniverse">
                                    </div>
                                    <div class="col-4">
                                        Address:
                                        <input type="number" class="form-control" v-model="fixtureProfileAddress">
                                    </div>
                                    <div class="col-4">
                                        Number:
                                        <input type="number" class="form-control" v-model="fixtureProfileNumber">
                                    </div>
                                </div>
                                <span v-if="isEmpty(fixtureProfiles) == true"
                                    class="fixtureProfileText p-1 d-inline-block mb-2">Loading
                                    fixture profiles...</span>
                                <span v-if="isEmpty(fixtureProfiles) == false"
                                    @click="clearFixtureProfilesSelection('manufacturers')" class="d-inline-block mb-2">
                                    <span class="fixtureProfileText p-1">All Fixtures</span>
                                </span>
                                <span v-if="fixtureProfilesManufacturer != ''" class="d-inline-block mb-2">
                                    <i class="fa-thin fa-angle-right"></i>
                                    <span class="fixtureProfileText p-1"
                                        @click="clearFixtureProfilesSelection('models')">{{fixtureProfilesManufacturer}}</span>
                                </span>
                                <span v-if="fixtureProfilesModel != '' && fixtureProfilesManufacturer != ''"
                                    class="d-inline-block mb-2">
                                    <i class="fa-thin fa-angle-right"></i>
                                    <span class="fixtureProfileText p-1">{{fixtureProfilesModel}}</span>
                                </span>
                                <input type="text" class="form-control mb-2" placeholder="Search"
                                    v-model="fixtureProfilesSearch">
                                <ul class="list-group profilesList">
                                    <span
                                        v-if="filteredFixtureProfilesList['objs'].length == 0 && isEmpty(fixtureProfiles) == false && fixtureProfilesSearch != ''"
                                        class="dark">Nothing matching this search parameter exists.</span>
                                    <li class="list-group-item fixtureProfileItem"
                                        v-for="profile in filteredFixtureProfilesList['objs']"
                                        @click="addFixture(profile.dcid, profile.file, profile.custom)"
                                        v-if="filteredFixtureProfilesList['type'] == 'modes'">
                                        <span v-if="profile.modeName != '-'">{{profile.modeName}}</span>
                                        <span v-if="profile.modeName == '-'">Default Mode</span>
                                        <span class="float-end"><b class="text-warning">Channels:</b>
                                            {{profile.channels}}</span>
                                    </li>
                                    <li class="list-group-item fixtureProfileItem"
                                        v-for="manufacturer in filteredFixtureProfilesList['objs']"
                                        v-if="filteredFixtureProfilesList['type'] == 'manufacturers'"
                                        @click="setFixtureProfilesSelection(manufacturer, filteredFixtureProfilesList['type'])">
                                        {{manufacturer}}
                                    </li>
                                    <li class="list-group-item fixtureProfileItem"
                                        v-for="model in filteredFixtureProfilesList['objs']"
                                        v-if="filteredFixtureProfilesList['type'] == 'models'"
                                        @click="setFixtureProfilesSelection(model, filteredFixtureProfilesList['type'])">
                                        {{model}}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12" v-if="fixtures.length == 0">
                    No fixtures have been patched. Use either the Add Fixture or RDM Search tools to add some to this
                    show.
                </div>
                <div class="table-responsive" v-if="fixtures.length != 0">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Universe</th>
                                <th scope="col">Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in fixtures" class="fixturePatchItem" @click="selectFixture(item.i)"
                                v-bind:class="{ selected: selectedFixtures.indexOf(item.i) >= 0 }">
                                <td>{{item.name}}</td>
                                <td>{{item.universe}}</td>
                                <td>{{item.address}}-{{item.maxOffset+item.address}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="row mt-3" v-if="fixturesTab == 'groups'">
                <div class="col-12" v-if="groups.length == 0">
                    No fixtures have been grouped. Use the Group tool in either the Fixture List or Fixture Grid tab to
                    group some together.
                </div>
                <div class="col-6 col-md-3 col-lg-2 col-xl-1 text-center mb-3" v-for="item in groups">
                    <div class="groupItem p-2" @click="selectGroup(item.i)"
                        v-bind:class="{ selected: selectedGroups.indexOf(item.i) >= 0 }">
                        {{item.name}}
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid mb-5" v-if="tab == 'groupSettings'">
            <div class="card mt-3">
                <div class="card-body">
                    <div class="row">
                        <div class="col-12 text-center">
                            <b v-if="selectedGroups.length == 1">Edit Group</b>
                            <b v-if="selectedGroups.length > 1">Edit Groups</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <label class="form-label">Name:</label>
                            <input id="groupNameInput" class="form-control" v-model="groupSettingsName"
                                @input="editGroups">
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <label class="form-label">Fixtures:</label>
                            <multiselect v-model="groupSettingsFixtures" track-by="id" label="name" :allow-empty="false"
                                :options="fixtureIds" :multiple="true" :taggable="true" @input="editGroupsFixtures">
                            </multiselect>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-6">
                            <button class="btn btn-success w-100"
                                v-bind:class="{ disabled: selectedGroups.length == 0 }">
                                <i class="fa-regular fa-sliders d-inline-block fa-lg"></i>
                                <span class="d-inline-block">Parameters</span>
                            </button>
                        </div>
                        <div class="col-6">
                            <button class="btn btn-danger w-100" v-bind:class="{ disabled: selectedGroups.length == 0 }"
                                @click="removeGroups">
                                <i class="fa-regular fa-trash-can d-inline-block fa-lg"></i>
                                <span class="d-inline-block">Delete</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="fixed-bottom">
            <div class="row header text-center ps-2 pe-2">
                <div class="col-3 tab pt-3 pb-3" @click="tab = 'fixtures'"
                    v-bind:class="{ active: (tab == 'fixtures' || tab == 'groupSettings') }">
                    Fixtures
                </div>
                <div class="col-3 tab pt-3 pb-3" @click="tab = 'cues'" v-bind:class="{ active: tab == 'cues' }">
                    Cues
                </div>
                <div class="col-3 tab pt-3 pb-3" @click="tab = 'effects'" v-bind:class="{ active: tab == 'effects' }">
                    Effects
                </div>
                <div class="col-3 tab pt-3 pb-3" @click="tab = 'presets'" v-bind:class="{ active: tab == 'presets' }">
                    Presets
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-multiselect@2.1.0"></script>
    <script src="static/vue-grid-layout.umd.min.js"></script>
    <script src="static/app.js"></script>
</body>

</html>